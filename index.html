<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>daq2val by stiegerb</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/github-light.css">
    <meta name="viewport" content="width=device-width">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>daq2val</h1>
        <p></p>

        <p class="view"><a href="https://github.com/stiegerb/daq2val">View the Project on GitHub <small>stiegerb/daq2val</small></a></p>


        <ul>
          <li><a href="https://github.com/stiegerb/daq2val/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/stiegerb/daq2val/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/stiegerb/daq2val">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <hr>

<h3>
<a id="get-the-scripts-do-it-once" class="anchor" href="#get-the-scripts-do-it-once" aria-hidden="true"><span class="octicon octicon-link"></span></a>Get the scripts (do it once)</h3>

<ul>
<li>
<p>Make a new folder (or use a pre-existing one):</p>

<ul>
<li><code>mkdir daq2test</code></li>
</ul>
</li>
<li>
<p>Get the scripts:</p>

<ul>
<li><code>git clone /nfshome0/stiegerb/Workspace/daq2val &amp;&amp; cd daq2val</code></li>
<li><code>git checkout production</code></li>
</ul>
</li>
<li>
<p>To get a new version simply do:</p>

<ul>
<li><code>git pull</code></li>
</ul>
</li>
</ul>

<hr>

<h3>
<a id="setup-do-it-once-before-running" class="anchor" href="#setup-do-it-once-before-running" aria-hidden="true"><span class="octicon octicon-link"></span></a>Setup (do it once before running)</h3>

<ul>
<li>
<p>ssh to dvsrv-C2F36-07-01 (or any other machine that has python 2.6+ and can ssh to the daq2 system)</p>

<ul>
<li><code>ssh dvsrv-C2F36-07-01</code></li>
</ul>
</li>
<li>
<p>Get a kerberos token:</p>

<ul>
<li><code>kinit</code></li>
</ul>
</li>
<li>
<p>Change into the working directory (<code>daq2test/daq2val/</code> in the example above):</p>

<ul>
<li><code>cd daq2test/daq2val/</code></li>
</ul>
</li>
<li>
<p>Set the environment:</p>

<ul>
<li><code>source setenv-daq2.sh</code></li>
</ul>

<p>or, when running on the daq2val system:</p>

<ul>
<li><code>source setenv-daq2val.sh</code></li>
</ul>
</li>
<li>
<p>Start launchers:
(make sure the symbol map makes sense and that you can ssh to each of the machines with no password or key query)</p>

<ul>
<li><code>./daq2Control/daq2Launchers.py --start -m daq2SymbolMap.txt  -l /tmp/launcherLog.txt</code></li>
</ul>
</li>
<li>
<p>To follow the xdaq output (best in a new window):</p>

<ul>
<li><code>tail -f /tmp/launcherLog.txt</code></li>
</ul>
</li>
<li>
<p>To stop the launchers again:</p>

<ul>
<li><code>./daq2Control/daq2Launchers.py --stop -m daq2SymbolMap.txt</code></li>
</ul>
</li>
<li>
<p>Check launcher status:</p>

<ul>
<li><code>./daq2Control/daq2Launchers.py --status -m daq2SymbolMap.txt</code></li>
</ul>
</li>
</ul>

<hr>

<h3>
<a id="simple-running-mostly-for-debugging" class="anchor" href="#simple-running-mostly-for-debugging" aria-hidden="true"><span class="octicon octicon-link"></span></a>Simple running (mostly for debugging)</h3>

<ul>
<li><p>Note that you can do most of the following with <code>--dry</code> first to see what it will do without sending anything. For more options and help, use any of the scripts with <code>--help</code> (or <code>-h</code>).</p></li>
<li>
<p>Start a config by using the <code>runDAQ2Test.py</code> script:</p>

<ul>
<li><code>./daq2Control/runDAQ2Test.py --start 12s12fx1x4_ibv.xml 4096 0.0 -v 5</code></li>
</ul>
</li>
<li>
<p>To stop it again, use the <code>--kill</code> option:</p>

<ul>
<li><code>./daq2Control/runDAQ2Test.py --kill 12s12fx1x4_ibv.xml 4096 0.0 -v 5</code></li>
</ul>
</li>
<li>
<p>You can also do the steps separately:</p>

<ul>
<li>Setup:</li>
</ul>

<p><code>./daq2Control/runDAQ2Test.py --prepare 12s12fx1x4_ibv.xml 4096 0.0 -v 5</code></p>

<ul>
<li>Configure:</li>
</ul>

<p><code>./daq2Control/runDAQ2Test.py --configure 12s12fx1x4_ibv.xml 4096 0.0 -v 5</code></p>

<ul>
<li>Enable:</li>
</ul>

<p><code>./daq2Control/runDAQ2Test.py --enable 12s12fx1x4_ibv.xml 4096 0.0 -v 5</code></p>

<ul>
<li>Stop (should get back to "Configured", but no guarantee):</li>
</ul>

<p><code>./daq2Control/runDAQ2Test.py --stop 12s12fx1x4_ibv.xml 4096 0.0 -v 5</code></p>

<ul>
<li>For more options, use <code>--help</code>
</li>
</ul>
</li>
</ul>

<hr>

<h3>
<a id="scanning-to-do-a-measurement" class="anchor" href="#scanning-to-do-a-measurement" aria-hidden="true"><span class="octicon octicon-link"></span></a>Scanning (to do a measurement)</h3>

<ul>
<li>
<p>Run a scan of fragment sizes over a single configuration:</p>

<ul>
<li><code>./daq2Control/runDAQ2Scan.py --stopRestart --maxSize 16000 --duration 120 12s12fx1x4_ibv.xml -v 5 -o output/</code></li>
<li>To set a custom scanning range, use <code>--maxSize</code>, <code>--minSize</code>, and <code>--stepSize</code>, with the argument in bytes.</li>
<li>To set the duration for each step use <code>--duration</code> with an argument in seconds.</li>
<li>For all the options use <code>--help</code>, but note that some are not entirely bugfree...</li>
</ul>
</li>
<li>
<p>Run a scan of fragment sizes over a set of configurations:</p>

<ul>
<li><code>./daq2Control/scanAll.py --stopRestart --maxSize 16000 --duration 120 overnight/*.xml -v 5 -o output/output/</code></li>
<li>
<code>scanAll.py</code> takes all the same arguments as <code>runDAQ2Scan.py</code>
</li>
</ul>
</li>
</ul>

<hr>

<h3>
<a id="configurator" class="anchor" href="#configurator" aria-hidden="true"><span class="octicon octicon-link"></span></a>Configurator</h3>

<ul>
<li>
<p>For EvB/gevb2g with FEROLs as input (run with <code>-h</code> to get all the options):</p>

<ul>
<li><code>./daq2Control/makeDAQ2Config.py 12s12fx1x4</code></li>
<li>To use the gevb2g instead of Remi's EvB: <code>--useGevb2g</code>
</li>
<li>To use UDAPL instead of IBV: <code>--useUDAPL</code>
</li>
<li>To change the ferol running mode: <code>--ferolMode frl_autotrigger</code> (options are <code>ferol_emulator</code> (default), <code>frl_autotrigger</code>, <code>frl_gtpe_trigger</code>, <code>efed_slink_gtpe</code>)</li>
<li>For all the options, try <code>--help</code>
</li>
</ul>
</li>
<li>
<p>For MStreamIO:</p>

<ul>
<li><code>./daq2Control/makeMSIOConfig.py 4x4</code></li>
</ul>
</li>
<li>
<p>For gevb2g with input emulator:</p>

<ul>
<li><code>./daq2Control/makeMSIOConfig.py --useGevb2g 4x4</code></li>
</ul>
</li>
</ul>

<hr>

<h3>
<a id="symbolmaps" class="anchor" href="#symbolmaps" aria-hidden="true"><span class="octicon octicon-link"></span></a>Symbolmaps</h3>

<ul>
<li>
<p>Create symbolmaps for the DAQ production system (this uses <code>2015-05-05-infiniband-ports.csv</code> as input. To blacklist machines, change the 0 to a 1 in the corresponding line/column):</p>

<ul>
<li><code>./daq2Control/makeDAQ2Symbolmap.py --nRUs 8 --nBUs 8 --splitBy 8 -v -o daq2SymbolMap_8x8.txt</code></li>
<li>To take only N machines from one leaf: <code>--splitBy N</code>
</li>
<li>To use only RU machines: <code>--useOnlyRUs</code>
</li>
<li>To add a dedicated EVM machine: <code>--addEVM</code>
</li>
<li>To maximally distribute the machines over all leafs: <code>--shuffle</code>
</li>
<li>For all the options, try <code>--help</code>
</li>
</ul>
</li>
<li>
<p>Print the cabling for a DAQ production system symbolmap:</p>

<ul>
<li><code>./daq2Control/printSwitchCabling.py customSymbolmap.txt</code></li>
</ul>
</li>
</ul>

<hr>

<h3>
<a id="plotting" class="anchor" href="#plotting" aria-hidden="true"><span class="octicon octicon-link"></span></a>Plotting</h3>

<ul>
<li>To create a throughput vs fragment size plot from a .csv file obtained from a scan (or downloaded from the web archive), use the <code>plotData.py</code> script in the plotting subdir. Note that this needs python 2.7+ and ROOT with pyROOT to be installed:

<ul>
<li><code>./plotting/plotData.py 1x1.csv 2x2.csv --legend '1x1' '2x2'</code></li>
</ul>
</li>
<li>Some of the additional plotting options are:

<ul>
<li>
<code>-o</code> to set the output file</li>
<li>
<code>--minx</code>, <code>--maxx</code>, <code>--miny</code>, <code>--maxy</code> to set the plotting range</li>
<li>
<code>--logy</code>, <code>--nologx</code> toggle logarithmic scale on y or x axis. Default is logarithmic in x.</li>
<li>
<code>--tag TEXT</code>, <code>--subtag TEXT</code> to add text boxes on the canvas.</li>
<li>
<code>--title</code>, <code>--titleX</code>, <code>--titleY</code> to set canvas title and axis labels</li>
<li>
<code>--legend 'TEXT1' 'TEXT2' 'TEXT3'</code> to set the legend. Number of arguments needs to match with the number of .csv files provided.</li>
<li>
<code>--sizeFromBU</code>, take the fragment size from the BU measurement instead of from the input</li>
<li>
<code>--rate</code> Set the rate curve (in kHz) to be displayed. Default is 100 kHz.</li>
</ul>
</li>
</ul>

<hr>

<h3>
<a id="troubleshoot" class="anchor" href="#troubleshoot" aria-hidden="true"><span class="octicon octicon-link"></span></a>Troubleshoot</h3>

<ul>
<li>If you get an error like this:</li>
</ul>

<pre><code>  File "./daq2Control/makeDAQ2Config.py", line 89
    configurator.evbns = ('gevb2g' if options.useGevb2g and not
                                    ^
SyntaxError: invalid syntax
</code></pre>

<pre><code>- Probably means you're on a machine with an old version of python (i.e. older than 2.6). Try `ssh dvsrv-C2F36-07-01`.
</code></pre>
      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/stiegerb">stiegerb</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
    
  </body>
</html>
